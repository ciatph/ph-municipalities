<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ColorLog.html">ColorLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorLog.html#log">log</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorLog.html#setColor">setColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorLog.html#setText">setText</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ExcelFactory.html">ExcelFactory</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ExcelFile.html">ExcelFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#download">download</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#followsStringPattern">followsStringPattern</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#getMunicipalityName">getMunicipalityName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#getProvinceName">getProvinceName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#listAllProvinces">listAllProvinces</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#listMunicipalities">listMunicipalities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#listProvinces">listProvinces</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#listRegions">listRegions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#load">load</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#setOptions">setOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#shapeJsonData">shapeJsonData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#writeMunicipalities">writeMunicipalities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#.hasSpecialChars">hasSpecialChars</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ExcelFile.html#.removeGarbledText">removeGarbledText</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Schema.html">Schema</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Schema.html#formatErrorLog">formatErrorLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Schema.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Schema.html#validate">validate</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#SHEETJS_COL">SHEETJS_COL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#arrayToString">arrayToString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#capitalizeText">capitalizeText</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#dataRowStart">dataRowStart</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#formatDisplay">formatDisplay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isObject">isObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#selectDataSource">selectDataSource</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h2>ph-municipalities</h2>
<p>The <strong>ph-municipalities</strong> NPM package provides <strong>NPM scripts</strong> that allow interactive querying of Philippine municipalities included in one or more provinces or from a whole region, with an option of writing them to JSON files from the command line through a CLI-like application and <strong>classes</strong> for parsing Excel file data sources.</p>
<p>It uses a <strong>PAGASA 10-day weather forecast Excel</strong> file in <code>/app/data/day1.xlsx</code> (downloaded and stored as of this 20220808) from PAGASA's <a href="https://www.pagasa.dost.gov.ph/climate/climate-prediction/10-day-climate-forecast">10-Day Climate Forecast web page</a> as the default data source.</p>
<blockquote>
<p>Since the <strong>PAGASA 10-day weather forecast Excel</strong> files do not have region names, the parser scripts sync it with the <strong>PAGASA Seasonal weather forecast</strong> regions and province names defined in the manually-encoded <code>/app/config/regions.json</code> file to determine the region names. The <strong>classes</strong> also provide an option to specify a new region name configuration file on initialization.</p>
</blockquote>
<p>It also asks users to key in the file download URL of a remote PAGASA 10-Day weather forecast Excel file should they want to use another Excel file for a new and updated data source.</p>
<blockquote>
<p><em><strong>INFO:</strong> When installing the package using <code>npm i ph-municipalities</code>, the default data source is inside <code>/data/day1.xlsx</code>. All source codes and files are also inside the <strong>ph-municipalities</strong> root directory.</em></p>
</blockquote>
<h3>Architecture Diagram</h3>
<p><img src="/ph-municipalities/diagram.png" alt="ph-municipalities-arch"></p>
<h3>Dataset Output</h3>
<p>Extracted municipalities are written in JSON files following the format:</p>
<pre class="prettyprint source"><code>{
  &quot;metadata&quot;: {
    &quot;source&quot;: &quot;https://pubfiles.pagasa.dost.gov.ph/pagasaweb/files/climate/tendayweatheroutlook/day1.xlsx&quot;,
    &quot;title&quot;: &quot;List of PH Municipalities By Province and Region&quot;,
    &quot;description&quot;: &quot;This dataset generated with reference to the excel file contents from the source URL on 20220808.&quot;,
    &quot;date_created&quot;: &quot;Mon Aug 08 2022&quot;
  },
  &quot;data&quot;: {
    &quot;Albay&quot;: [&quot;Bacacay&quot;, &quot;Camalig&quot;, ... ],
    &quot;Camarines Norte&quot;: [&quot;Basud&quot;, &quot;Capalonga&quot;, ... ],
    &quot;Camarines Sur&quot;: [&quot;Baao&quot;, &quot;Balatan&quot;, ... ],
    ...
  }
}
</code></pre>
<p>Pre-compiled windows binaries are available for download in the latest <a href="https://github.com/ciatph/ph-municipalities/releases">Releases</a> download page.</p>
<h2>Class Documentation</h2>
<ul>
<li>Class documentation and methods are available at https://ciatph.github.io/ph-municipalities.</li>
<li>The documentation website's HTML files are available in the <a href="https://github.com/ciatph/ph-municipalities/tree/gh-pages"><code>gh-pages</code></a> branch of this repository.</li>
<li>Refer to the <a href="#building-the-class-documentation">Building the Class Documentation</a> section for more information about updating and building the class documentation.</li>
</ul>
<h2>Requirements</h2>
<p>The following dependencies are used for this project. Feel free to use other dependency versions as needed.</p>
<details>
<summary>Requirements list</summary>
<ol>
<li>Windows 10 OS</li>
<li>nvm for Windows v1.1.9</li>
<li>NodeJS, installed using nvm
<ul>
<li>node v16.14.2</li>
<li>npm v8.5.0</li>
</ul>
</li>
<li>Excel file
<ul>
<li>ph-municipalities uses Excel files in the <code>/app/data</code> directory as data source.</li>
<li>At minimum, the Excel file should have a <strong>column</strong> that contains municipality and province names following the pattern <code>&quot;municipalityName (provinceName)&quot;</code></li>
<li>(Optional) The Excel file should have a row on the same <strong>column</strong> as above containing the text <code>&quot;Project Areas&quot;</code> plus two (2) blank rows before rows containing municipality and province names to enable strict testing and validation of the number of parsed data rows</li>
<li>Checkout the excel file format on the <code>/app/data/day1.xlsx</code> sample file for more information</li>
</ul>
</li>
<li>(Optional) Download URL for a remote excel file.
<ul>
<li>See the <code>EXCEL_FILE_URL</code> variable on the <a href="#installation">Installation</a> section.</li>
</ul>
</li>
</ol>
</details>
<h2>Table of Contents</h2>
<details>
<summary>
Click to expand the table of contents
</summary>
<ul>
<li><a href="#ph-municipalities">ph-municipalities</a></li>
<li><a href="#class-documentation">Class Documentation</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#installation-using-docker">Installation Using Docker</a></li>
<li><a href="#available-scripts">Available Scripts</a>
<ul>
<li><a href="#interactive-cli-scripts">Interactive CLI Scripts</a>
<ul>
<li><a href="#npm-start--npm-run-listregion"><code>npm start</code> / <code>npm run list:region</code></a></li>
<li><a href="#npm-run-listprovince"><code>npm run list:province</code></a></li>
</ul>
</li>
<li><a href="#npm-scripts-for-building-documentation">NPM Scripts for Building Documentation</a>
<ul>
<li><a href="#npm-run-generate-docs"><code>npm run generate-docs</code></a></li>
<li><a href="#npm-run-docsinstall"><code>npm run docs:install</code></a></li>
<li><a href="#npm-run-docsbuild"><code>npm run docs:build</code></a></li>
</ul>
</li>
<li><a href="#npm-scripts-for-building-windows-executable-files-of-the-interactive-cli-scripts">NPM Scripts for Building Windows Executable Files of the Interactive CLI Scripts</a>
<ul>
<li><a href="#buildwinregion"><code>build:win:region</code></a></li>
<li><a href="#buildwinprovince"><code>build:win:province</code></a></li>
<li><a href="#buildwinall"><code>build:win:all</code></a></li>
<li><a href="#npm-run-minifyregion"><code>npm run minify:region</code></a></li>
</ul>
</li>
<li><a href="#npm-scripts-for-compiling-the-interactive-cli-scripts-into-stand-alone-scripts">NPM Scripts for Compiling the Interactive CLI Scripts into Stand-Alone Scripts</a>
<ul>
<li><a href="#npm-run-minifyprovince"><code>npm run minify:province</code></a></li>
<li><a href="#npm-run-minifyall"><code>npm run minify:all</code></a></li>
</ul>
</li>
<li><a href="#npm-scripts-for-linting-files-and-unit-testing">NPM Scripts for Linting Files and Unit Testing</a>
<ul>
<li><a href="#npm-run-lint"><code>npm run lint</code></a></li>
<li><a href="#npm-run-lintfix"><code>npm run lint:fix</code></a></li>
<li><a href="#npm-test"><code>npm test</code></a></li>
<li><a href="#npm-run-example"><code>npm run example</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#class-usage">Class Usage</a>
<ul>
<li><a href="#load-and-parse-a-local-excel-file">Load and Parse a Local Excel File</a></li>
<li><a href="#download-and-parse-a-remote-excel-file">Download and Parse a Remote Excel File</a></li>
<li><a href="#alternate-usage---events">Alternate Usage - Events</a></li>
<li><a href="#using-a-custom-configuration-file">Using a Custom Configuration File</a></li>
</ul>
</li>
<li><a href="#building-standalone-windows-executables">Building Standalone Windows Executables</a></li>
<li><a href="#compiling-into-single-minified-files">Compiling into Single, Minified Files</a></li>
<li><a href="#building-the-class-documentation">Building the Class Documentation</a>
<ul>
<li><a href="#using-docker">Using Docker</a></li>
<li><a href="#using-nodejs">Using NodeJS</a></li>
</ul>
</li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
</details>
<h2>Installation</h2>
<ol>
<li>
<p>Clone this repository.<br>
<code>git clone https://github.com/ciatph/municipalities-by-province.git</code></p>
</li>
<li>
<p>Install dependencies.<br></p>
<pre class="prettyprint source lang-bash"><code>cd app
npm install
</code></pre>
</li>
<li>
<p>Create a <code>.env</code> file from the <code>.env.example</code> file inside the <code>/app</code> directory. Use the default values for the following environment variables.</p>
<details>
<summary>List of .env variables and their description.</summary>
<blockquote>
<p><strong>INFO:</strong> If installed as an NPM package with <code>npm i ph-municipalities</code>, create the <code>.env</code> file inside the NPM project's root directory.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>EXCEL_FILE_URL</td>
<td>(Optional) Remote excel file's download URL.<br>If provided, the excel file will be downloaded and saved on the specified <code>pathToFile</code> local filesystem location during the <code>ExcelFile</code> class initialization.<br>Read on <a href="#usage">Usage</a> for more information.</td>
</tr>
<tr>
<td>SHEETJS_COLUMN</td>
<td>Column name read by <a href="https://sheetjs.com/">sheetjs</a> in an excel file.<br>This column contains the municipality and province names following the string pattern<br><code>&quot;municipalityName (provinceName)&quot;</code><br>Default value is <code>__EMPTY</code></td>
</tr>
<tr>
<td>SORT_ALPHABETICAL</td>
<td>Arranges the municipality names in alphabetical order.<br>Default value is <code>1</code>. Set to <code>0</code> to use the ordering as read from the Excel file.</td>
</tr>
<tr>
<td>SPECIAL_CHARACTERS</td>
<td>Key-value pairs of special characters or garbled text and their normalized text conversions, delimited by the <code>&quot;:&quot;</code> character.<br>Multiple key-value pairs are delimited by the <code>&quot;,&quot;</code> character.<br>If a special character key's value is a an empty string, write it as i.e.,: <code>&quot;some-garbled-text:&quot;</code></td>
</tr>
<tr>
<td>IMAGE_URL</td>
<td>Raw URL of the README image file from this GitHub repository.<br> <blockquote><strong>NOTE:</strong> Only add this variable in the GitHub Secrets for publishing to the NPM registry since NPM does not allow displaying images by relative path.</blockquote></td>
</tr>
</tbody>
</table>
</details>
</li>
</ol>
<h2>Installation Using Docker</h2>
<p>We can use Docker to run dockerized Node app for local development mode. The following methods require Docker and Docker compose correctly installed and set up on your development machine.</p>
<h3>Docker Dependencies</h3>
<details>
<summary>
The following dependencies are used to build and run the image. Please feel feel free to use other OS and versions as needed.
</summary>
<ol>
<li>Ubuntu 22.04.1
<ul>
<li>Docker version 23.0.1, build a5eeb1</li>
<li>Docker Compose v2.16.0</li>
</ul>
</li>
<li>Microsoft Windows 10 Pro
<ul>
<li>version 22H2 Build 19045.4651</li>
<li>Docker Desktop
<ul>
<li>Docker Compose version v2.27.1-desktop.1</li>
<li>Docker Engine version 26.1.4, build 5650f9b</li>
</ul>
</li>
</ul>
</li>
</ol>
</details>
<h3>Docker for Localhost Development</h3>
<details>
<summary>Steps for using Docker with local development</summary>
<ol>
<li>
<p>Set up the environment variables for the <code>/app</code> directory. Visit the <a href="#installation">Installation</a> section, <strong>step #3</strong> for more information.</p>
</li>
<li>
<p>Stop and delete all docker instances for a fresh start.</p>
<ul>
<li>
<blockquote>
<p><strong>NOTE:</strong> Running this script will delete all docker images, containers, volumes, and networks. Run this script if you feel like everything is piling but do not proceed if you have important work on other running Docker containers.</p>
</blockquote>
</li>
<li>
<pre class="prettyprint source"><code> sudo chmod u+x scripts/docker-cleanup.sh
 ./scripts/docker-cleanup.sh
 # Answer all proceeding prompts
</code></pre>
</li>
</ul>
</li>
<li>
<p>Build and run the app using Docker.</p>
<ul>
<li>Build<br>
<code>docker compose -f docker-compose.dev.yml build</code></li>
<li>Run<br>
<code>docker compose -f docker-compose.dev.yml up</code></li>
<li>Stop<br>
<code>docker compose -f docker-compose.dev.yml down</code></li>
</ul>
</li>
<li>
<p>Edit and execute scripts within the running docker container from <strong>step #3</strong>.</p>
<ul>
<li>For running NPM scripts (see the <a href="#available-scripts">Available Scripts</a> section for more information):<br>
<code>docker exec -it ph-municipalities &lt;NPM_SCRIPT&gt;</code></li>
<li>For new scripts (example only):<br>
<code>docker exec -it ph-municipalities node ./src/new.js</code></li>
</ul>
</li>
</ol>
</details>
<h2>Available Scripts</h2>
<blockquote>
<p><em><strong>Note:</strong> These NPM scripts run relative within the <code>/app</code> directory, when working on a git-cloned repository of the app. To run using only NodeJS, navigate first to the <code>/app</code> directory and execute a target script, for example:</em></p>
</blockquote>
<pre class="prettyprint source"><code>cd app
npm run list:region
</code></pre>
<details>
<summary style="font-size: 18px;" id="interactive-cli-scripts">
  <b>Interactive CLI Scripts</b>
</summary>
<h3><code>npm start</code> / <code>npm run list:region</code></h3>
<ul>
<li>Asks users to enter the download URL of a remote excel file or use the default local excel file
<ul>
<li>Loads and parses the local excel file in <code>/app/data/day1.xlsx</code> by default.</li>
<li>Loads and parses the downloaded excel file to <code>/app/data/datasource.xlsx</code> if download URL in the class constructor is provided.</li>
</ul>
</li>
<li>Displays a list of available PH <strong>region</strong> names.</li>
<li>Lists all provinces and municipalities of a specified region via commandline input.</li>
<li>Asks for an option to write results to a JSON file.</li>
<li>Run the script as follows if installed using <code>npm i ph-municipalities</code>:
<ul>
<li><code>node .\node_modules\ph-municipalities\src\scripts\by_region.js</code></li>
</ul>
</li>
</ul>
<h3><code>npm run list:province</code></h3>
<ul>
<li>Asks users to enter the download URL of a remote excel file or use the default local excel file
<ul>
<li>Loads and parses the local excel file in <code>/app/data/day1.xlsx</code> by default.</li>
<li>Loads and parses the downloaded excel file to <code>/app/data/datasource.xlsx</code> if download URL in the class constructor is provided.</li>
</ul>
</li>
<li>Lists all municipalities under specified province(s) via commandline input.</li>
<li>Asks for an option to write results to a JSON file.</li>
<li>Run the script as follows if installed using <code>npm i ph-municipalities</code>:
<ul>
<li><code>node .\node_modules\ph-municipalities\src\scripts\by_province.js</code></li>
</ul>
</li>
</ul>
</details>
<hr>
<details>
<summary style="font-size: 18px;" id="npm-scripts-for-building-documentation">
  <b>NPM Scripts for Building Documentation</b>
</summary>
<h3><code>npm run generate-docs</code></h3>
<p>Builds the class documentation into the <strong>/docs</strong> directory.</p>
<blockquote>
<p>[!NOTE]
This script requires manual installation of the <code>jsdoc@4.0.3</code>, <code>minami@1.2.3</code>, and <code>taffydb@2.7.3</code> packages as <strong>devDependencies</strong> inside the <strong>/app</strong> directory.
These libraries, only used for building the class documentation, were excluded from the final package.json to have fewer external dependencies.</p>
<pre class="prettyprint source lang-bash"><code>npm install --save-dev jsdoc@4.0.3 minami@1.2.3 taffydb@2.7.3
</code></pre>
<p>Installing these libraries will update the <code>package.json</code> and <code>package-lock.json</code> files. Take care not to push changes caused by installation.</p>
</blockquote>
<h3><code>npm run docs:install</code></h3>
<p>Runs the Bash script that installs the JSDoc and theme dependencies for building the class documentation only within the <strong>development Docker environment</strong>.</p>
<blockquote>
<p>[!NOTE]
This script requires running from a Bash terminal - it won't work from a Windows command line terminal. It is reserved for building the documentation with Docker.</p>
</blockquote>
<p>This script is used for building the class documentation from a local Docker environment along with the <code>npm run docs:build</code> NPM script.</p>
<pre class="prettyprint source lang-bash"><code>docker exec -u root -it ph-municipalities npm run docs:install
docker exec -u root -it ph-municipalities npm run docs:build
</code></pre>
<h3><code>npm run docs:build</code></h3>
<p>Runs the Bash script that builds the class documentation using JSDoc only within the <strong>development Docker environment</strong>.</p>
<blockquote>
<p>[!NOTE]
This script requires running from a Bash terminal - it won't work from a Windows command line terminal. It is reserved for building the documentation with Docker.</p>
</blockquote>
<p>This script is used for building the class documentation from a local Docker environment along with the <code>npm run docs:install</code> NPM script.</p>
<pre class="prettyprint source lang-bash"><code>docker exec -u root -it ph-municipalities npm run docs:install
docker exec -u root -it ph-municipalities npm run docs:build
</code></pre>
</details>
<hr>
<details>
<summary style="font-size: 18px;" id="npm-scripts-for-building-windows-executable-files-of-the-interactive-cli-scripts">
  <b>NPM Scripts for Building Windows Executable Files of the Interactive CLI Scripts</b>
</summary>
<h3><code>build:win:region</code></h3>
<ul>
<li>Package the Node.js project's <code>npm start</code> script into a stand-alone windows <code>node16-win-x64</code> executable.</li>
<li>The windows executable file will be stored in <code>/dist/ph-regions-win.exe</code>. Click the executable file to run.</li>
</ul>
<h3><code>build:win:province</code></h3>
<ul>
<li>Package the Node.js project's <code>npm list:province</code> script into a stand-alone windows <code>node16-win-x64</code> executable.</li>
<li>The windows executable file will be stored in <code>/dist/ph-provinces-win.exe</code>. Click the executable file to run.</li>
</ul>
<h3><code>build:win:all</code></h3>
<ul>
<li>Package the Node.js project's <code>npm start</code> and <code>npm list:province</code> script into a stand-alone windows <code>node16-win-x64</code> executables in one go.</li>
<li>Each window executable file will be stored in the <code>/dist</code> directory.</li>
</ul>
</details>
<hr>
<details>
<summary style="font-size: 18px;" id="npm-scripts-for-compiling-the-interactive-cli-scripts-into-stand-alone-scripts">
  <b>NPM Scripts for Compiling the Interactive CLI Scripts into Stand-Alone Scripts</b>
</summary>
<h3><code>npm run minify:region</code></h3>
<ul>
<li>Compiles the Node.js project's <code>npm list:region</code> script and dependencies into a single script using <a href="https://www.npmjs.com/package/@vercel/ncc"><strong>ncc</strong></a>.</li>
<li>The compiled/minified file will be stored in <code>/dist/region</code>. Run the command to use the compiled script:<br>
<code>node dist/region</code></li>
</ul>
<h3><code>npm run minify:province</code></h3>
<ul>
<li>Compiles the Node.js project's <code>npm list:province</code> script and dependencies into a single script using <a href="https://www.npmjs.com/package/@vercel/ncc"><strong>ncc</strong></a>.</li>
<li>The compiled/minified file will be stored in <code>/dist/province</code>. Run the command to use the compiled script:<br>
<code>node dist/province</code></li>
</ul>
<h3><code>npm run minify:all</code></h3>
<ul>
<li>Run the <code>npm list:region</code> and <code>npm list:province</code> scripts in one go.</li>
<li>Each compiled/minified files will be stored in the <code>/dist</code> directory.</li>
</ul>
</details>
<hr>
<details>
<summary style="font-size: 18px;" id="npm-scripts-for-linting-files-and-unit-testing">
  <b>NPM Scripts for Linting Files and Unit Testing</b>
</summary>
<h3><code>npm run lint</code></h3>
<p>Lint JavaScript source codes.</p>
<h3><code>npm run lint:fix</code></h3>
<p>Fix JavaScript lint errors.</p>
<h3><code>npm test</code></h3>
<p>Run tests defined in the <code>/app/__tests__</code> directory.</p>
<h3><code>npm run example</code></h3>
<ul>
<li>Downloads and parses a remote excel file.</li>
<li>Demonstrates sample usage with <code>await</code></li>
</ul>
</details>
<h2>Class Usage</h2>
<p>Below are example usages of the <code>ExcelFile</code> class, run from the <strong>/app/src/examples</strong> directory. Check out the <code>/app/src/examples/sample_usage.js</code> file for more examples.</p>
<h3>Load and Parse a Local Excel File</h3>
<p>This is a simple usage example of the <code>ExcelFile</code> class.</p>
<details>
<summary><b>Simple Usage</b></summary>
<pre class="prettyprint source lang-javascript"><code>const path = require('path')
const ExcelFile = require('../classes/excel')

// Use the the following if installed via npm
// const { ExcelFile } = require('ph-municipalities')

// Reads an existing excel file on /app/data/day1.xlsx
file = new ExcelFile({
   pathToFile: path.join(__dirname, '..', '..', 'data', 'day1.xlsx'),
   // fastload: false
})

// Call init() if fastload=false
// file.init()

// listMunicipalities() lists all municipalities
// for each province
const provinces = ['Albay','Masbate','Sorsogon']
const municipalitiesFromProvince = file.listMunicipalities({ provinces })

// writeMunicipalities() writes municipalities data to a JSON file
// and returns the JSON object
const json = file.writeMunicipalities({
   provinces,
   fileName: path.join(__dirname, 'municipalities.json'),
   prettify: true
})

// shapeJsonData() returns the output of writeMunicipalities()
// without writing to a JSON file
const json2 = file.shapeJsonData(provinces)

// JSON data of the parsed excel file will is accessible on
// file.datalist
console.log(file.datalist)

// Set the contents of file.datalist
file.datalist = [
   { municipality: 'Tayum', province: 'Abra' },
   { municipality: 'Bucay', province: 'Abra' }]
</code></pre>
</details>
<details>
<summary>
  <b>Reading regions, provinces and municipalities</b>
</summary>
<pre class="prettyprint source lang-javascript"><code>const path = require('path')
const ExcelFile = require('../classes/excel')

// Use the the following if installed via npm
// const { ExcelFile } = require('ph-municipalities')

// Reads an existing excel file on /app/data/day1.xlsx
const file = new ExcelFile({
  pathToFile: path.join(__dirname, '..', '..', 'data', 'day1.xlsx'),
  fastload: true
})

// listRegions() lists all regions from the regions settings file
const regions = file.listRegions()
console.log('---regions', regions)

// List region data from query
const regionQuery = file.listRegions('region_name')
console.log(`---region full name`, regionQuery)

// listProvinces() lists all provinces of a region
// for each given province
const provinces = file.listProvinces('Region IX')
console.log(`---provinces of ${regions[0]}`, provinces)

const municipalitiesFromProvince = file.listMunicipalities({ provinces })
console.log(`---municipalities`, municipalitiesFromProvince)
</code></pre>
</details>
<h3>Download and Parse a Remote Excel File</h3>
<p>Adding a <code>url</code> field in the constructor parameter prepares the class to download a remote Excel file for the data source.</p>
<details>
<summary>
  <b>Remote Excel file download example</b>
</summary>
<blockquote>
<p><strong>INFO:</strong> Run the <code>.init()</code> method after initializing a class with a <code>url</code> parameter to start the async file download.</p>
</blockquote>
<pre class="prettyprint source lang-javascript"><code>require('dotenv').config()
const path = require('path')
const ExcelFile = require('../classes/excel')

// Use the the following if installed via npm
// const { ExcelFile } = require('ph-municipalities')

const main = async () => {
  // Excel file will be downloaded to /app/src/examples/excelfile.xlsx
  const file = new ExcelFile({
    pathToFile: path.join(__dirname, 'excelfile.xlsx'),
    url: process.env.EXCEL_FILE_URL
  })

  try {
    // Download file
    await file.init()
    console.log(file.datalist)
  } catch (err) {
    console.log(err.message)
  }
}

main()
</code></pre>
</details>
<h3>Alternate Usage - Events</h3>
<details>
<summary>
  <b>Initialize an ExcelFile class instance.</b>
</summary>
<pre class="prettyprint source lang-javascript"><code>require('dotenv').config()
const path = require('path')

const ExcelFile = require('../classes/excel')

// Use the the following if installed via npm
// const { ExcelFile } = require('ph-municipalities')

const main = () => {
  try {
    // Initialize an ExcelFile class instance.
    const PHExcel = new ExcelFile({
      pathToFile: path.join(__dirname, 'excelfile.xlsx'),
      url: process.env.EXCEL_FILE_URL
    })

    // Download file
    PHExcel.init()

    // Listen to the instance's EVENTS.LOADED event.
    PHExcel.events.on(PHExcel.EVENTS.LOADED, () => {
      console.log('--Excel data loaded!', PHExcel.datalist)
    })
  } catch (err) {
    console.log(`[ERROR]: ${err.message}`)
  }
}

main()
</code></pre>
</details>
<h3>Using a Custom Configuration File</h3>
<p>The <strong>ph-municipalities</strong> <code>ExcelFile</code> and <code>ExcelFactory</code> classes use a default configuration file to define their regions and provinces in the <code>/app/config/regions.json</code> file. The regions and provinces data in this file syncs with the PAGASA Seasonal and 10-Day Weather Forecast Excel files provinces and municipalities naming convention, encoded by hand as of August 24, 2024.</p>
<p>Follow the codes to define a custom regions config file, following the format of the <code>/app/config/regions.json</code> file to customize region definitions.</p>
<blockquote>
<p><em><strong>Note:</strong> The custom config file's province/municipality names should match those in the 10-day Excel file.</em></p>
</blockquote>
<details>
<summary>
  <b>config.json</b>
</summary>
<pre class="prettyprint source"><code>{
  &quot;metadata&quot;: {
    &quot;sources&quot;: [
      &quot;http://localhost:3000&quot;
    ],
    &quot;title&quot;: &quot;List of Random Provinces by Regions&quot;,
    &quot;description&quot;: &quot;Sample regions config file&quot;,
    &quot;date_created&quot;: &quot;20240824&quot;
  },
  &quot;data&quot;: [
    {
      &quot;name&quot;: &quot;Mondstat&quot;,
      &quot;abbrev&quot;: &quot;MON&quot;,
      &quot;region_num&quot;: &quot;1&quot;,
      &quot;region_name&quot;: &quot;The City of Freedom&quot;,
      &quot;provinces&quot;: [&quot;Brightcrown Mountains&quot;,&quot;Galesong Hill&quot;,&quot;Starfell Valley&quot;,&quot;Windwail Highland&quot;,&quot;Dragonspine&quot;]
    },
    {
      &quot;name&quot;: &quot;Inazuma&quot;,
      &quot;abbrev&quot;: &quot;INZ&quot;,
      &quot;region_num&quot;: &quot;3&quot;,
      &quot;region_name&quot;: &quot;The Realm of Eternity&quot;,
      &quot;provinces&quot;: [&quot;Narukami&quot;,&quot;Kannazuka&quot;,&quot;Yashiori&quot;,&quot;Watatsumi&quot;,&quot;Seirai&quot;,&quot;Tsurumi&quot;,&quot;Enkanomiya&quot;]
    },
    ...
  ]
}
</code></pre>
</details>
<details>
<summary>
  <b>Custom config usage</b>
</summary>
<pre class="prettyprint source lang-javascript"><code>require('dotenv').config()
const path = require('path')

const ExcelFile = require('../classes/excel')

// Use the the following if installed via npm
// const { ExcelFile } = require('ph-municipalities')

const config = require('./config.json')

// Load the local Excel file
const file = new ExcelFile({
  pathToFile: path.join(__dirname, '..', '..', 'data', 'day1.xlsx'),
  fastload: true,
  // Use a custom settings file to define region info
  settings: config
})

// Load provinces from the custom config file
const provinces = file.listProvinces('Inazuma')

// List the municipalities of defined provinces in the config file
// Note: Province/municipality names should match with those in the 10-day Excel file
const municipalities = file.listMunicipalities({ provinces })

console.log('---provinces', provinces)

console.log('\nProvince/municipality names should match with those in the 10-day Excel file')
console.log('---municipalities', municipalities)
</code></pre>
</details>
<h2>Building Standalone Windows Executables</h2>
<p>The main npm scripts can be packaged into standalone windows executables. Pre-compiled windows binaries are available for download in the latest <a href="https://github.com/ciatph/ph-municipalities/releases">Releases</a> download page.</p>
<ol>
<li>Run any of the following scripts to build the programs.<pre class="prettyprint source lang-bash"><code>npm run build:win:region
npm run build:win:province
# npm run build:win:all
</code></pre>
</li>
<li>Click the resulting executable files in the <code>/dist</code> directory to execute.</li>
</ol>
<h2>Compiling into Single, Minified Files</h2>
<p>The main npm scripts can be compiled into standalone JavaScript files together with all its dependencies.</p>
<ol>
<li>Run any of the following scripts to compile the source codes.<pre class="prettyprint source lang-bash"><code>npm run minify:region
npm run minify:province
# npm run minify:all
</code></pre>
</li>
<li>Run the compiled source codes in the <code>/dist</code> directory to execute.<pre class="prettyprint source lang-bash"><code>node dist/region
node dist/province
</code></pre>
</li>
</ol>
<h2>Building the Class Documentation</h2>
<p>The class documentation uses <a href="https://jsdoc.app/">JSDoc</a> annotations where applicable in the JavaScript source codes inside the <strong>/src</strong> directory. There are two (2) options for building the class documentation.</p>
<details>
<summary style="font-size: 18px;" id="using-docker">
  <b>Using Docker</b>
</summary>
<ol>
<li>
<p>Run docker for localhost development. Refer to the <a href="#docker-for-localhost-development">Docker for Localhost Development</a> section for more information.</p>
</li>
<li>
<p>Install the dependencies for JSDoc. Suceeding builds will not need to install dependencies after an initial installation. Refer to the <a href="#npm-run-docsinstall"><strong>npm run docs:install</strong></a> script usage for more information.<br></p>
<pre class="prettyprint source lang-bash"><code>docker exec -u root -it ph-municipalities npm run docs:install
</code></pre>
</li>
<li>
<p>Build the documentation. Refer to the <a href="#npm-run-docsbuild"><strong>npm run docs:build</strong></a> script usage for more information.<br></p>
<pre class="prettyprint source lang-bash"><code>docker exec -u root -it ph-municipalities npm run docs:build
</code></pre>
</li>
</ol>
</details>
<br>
<details>
<summary style="font-size: 18px;" id="using-nodejs">
  <b>Using NodeJS</b>
</summary>
<ol>
<li>
<p>Install the dependencies for JSDoc. Refer to the <a href="#npm-run-generate-docs"><strong><code>npm run generate-docs</code></strong></a> Script usage for more information.</p>
</li>
<li>
<p>Copy Bash scripts to the <strong>/app</strong> directory.</p>
<ul>
<li>Create a <strong>/scripts</strong> directory inside the <strong>/app</strong> directory.</li>
<li>Copy the <code>/scripts/docs-install.sh</code> and <code>/scripts/docs-build.sh</code> Bash scripts to the <strong>/scripts</strong> directory created from the previous step.</li>
</ul>
</li>
<li>
<p>Copy static assets to the <strong>/app</strong> directory.</p>
<ul>
<li>Copy the <code>/docs/diagrams</code> directory inside the <strong>/app</strong> directory.</li>
<li>Copy the <code>README.md</code> file to the <strong>/app</strong> directory.</li>
</ul>
</li>
<li>
<p>Add appropriate user permission to the files.</p>
<pre class="prettyprint source lang-bash"><code>chmod u+x scripts/docs-install.sh
chmod u+x scripts/docs-build.sh
</code></pre>
</li>
<li>
<p>Run the commands for building the documentation.</p>
<blockquote>
<p><strong>INFO:</strong> Use a GitBash terminal if you are working on a Windows OS machine.</p>
</blockquote>
<pre class="prettyprint source lang-bash"><code>./scripts/docs-install.sh
./scripts/docs-build.sh
</code></pre>
</li>
</ol>
</details>
<h2>Troubleshooting</h2>
<p>This section describes several common errors and related fixes.</p>
<details>
<summary style="font-size: 18px;">
  <b>EACCESS: permission denied</b>
</summary>
<h4>Information</h4>
<ul>
<li>This error usually happens when writing to files inside Docker-mounted volumes on an Ubuntu host during run time.</li>
<li>A full sample error log is:<br>
<blockquote>
<p>EACCESS: permission denied, open '/opt/app/region1.json'</p>
</blockquote>
</li>
</ul>
<h4>Fix</h4>
<ol>
<li>Find the host UID of the ph-municipalities Docker user. Its name is <code>&quot;app,&quot;</code> defined in the Dockerfile.<br>
<code>docker run --rm -it ciatph/ph-municipalities:dev sh -c &quot;id -u app&quot;</code></li>
<li>Change the ownership of the <code>./app</code> directory using the ph-municipalities user host UID from <strong>step #1</strong>.<br>
<code>sudo chown -R &lt;APP_UID&gt;:&lt;APP_UID&gt; ./app</code></li>
<li>Re-run the NPM script.</li>
</ol>
</details>
<br>
<p>@ciatph<br>
20220807</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Thu Sep 12 2024 17:14:47 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>